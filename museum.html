<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    html,body{height:100%;margin:0}
    .viewer-wrap{position:relative;display:flex;flex-direction:column;height:70vh}
    model-viewer{width:100%;height:100%;display:block;background:#111}
    .controls{padding:.5rem;background:#fff;display:flex;gap:.5rem;align-items:center}
    .overlay{
      position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
      pointer-events:none;
    }
    .status {
      pointer-events:auto;padding:.75rem 1rem;border-radius:.5rem;background:rgba(0,0,0,.7);
      color:#fff;font-size:.95rem;
    }
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="viewer-wrap">
    <model-viewer id="mv"
      src="model/camel.glb"
      alt="Camel 3D model"
      ar
      ar-modes="webxr scene-viewer quick-look"
      camera-controls
      auto-rotate
      auto-rotate-delay="1000"
      rotation-per-second="30deg/s"
      shadow-intensity="1"
      exposure="1"
      environment-image="neutral"
      reveal="auto">
    </model-viewer>

    <div class="overlay">
      <div id="status" class="status">Loading model…</div>
    </div>

    <div class="controls">
      <button id="resetCam" class="btn btn-sm btn-primary">Reset Camera</button>
      <button id="toggleRotate" class="btn btn-sm btn-secondary">Pause Rotate</button>
      <label class="mb-0">Environment
        <select id="envSelect" class="form-select form-select-sm ms-2" style="width:auto;display:inline-block">
          <option value="neutral">Neutral</option>
          <option value="studio">Studio</option>
          <option value="blurred">Blurred</option>
        </select>
      </label>
      <div class="ms-auto text-muted small">Tip: drag to orbit, pinch to zoom, tap AR for supported devices</div>
    </div>
  </div>

  <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>
  <script>
    const mv = document.getElementById('mv');
    const status = document.getElementById('status');
    const resetBtn = document.getElementById('resetCam');
    const toggleBtn = document.getElementById('toggleRotate');
    const envSelect = document.getElementById('envSelect');

    // Diagnostics: show protocol hint if opened via file://
    if (location.protocol === 'file:') {
      status.textContent = 'Open via a local server for full model support (see note below).';
    }

    // Load / progress / error handlers
    mv.addEventListener('progress', (e) => {
      const p = Math.round((e.detail.totalProgress || 0) * 100);
      status.textContent = `Loading model… ${p}%`;
      if (p >= 100) {
        setTimeout(() => status.classList.add('hidden'), 350);
      }
    });

    mv.addEventListener('load', () => {
      status.textContent = 'Model loaded';
      setTimeout(() => status.classList.add('hidden'), 400);
    });

    mv.addEventListener('error', (ev) => {
      console.error('model-viewer error', ev);
      status.classList.remove('hidden');
      status.textContent = 'Failed to load model. Check console and ensure model/camel.glb exists and you are serving the folder via HTTP.';
    });

    // Default camera goal
    const defaultCamera = {
      orbit: mv.getAttribute('camera-orbit') || '0deg 75deg 2.5m',
      target: mv.getAttribute('camera-target') || '0m 0m 0m'
    };

    resetBtn.addEventListener('click', () => {
      mv.cameraOrbit = defaultCamera.orbit;
      mv.cameraTarget = defaultCamera.target;
      mv.jumpCameraToGoal();
    });

    toggleBtn.addEventListener('click', () => {
      const on = mv.hasAttribute('auto-rotate');
      if (on) {
        mv.removeAttribute('auto-rotate');
        toggleBtn.textContent = 'Resume Rotate';
      } else {
        mv.setAttribute('auto-rotate', '');
        toggleBtn.textContent = 'Pause Rotate';
      }
    });

    envSelect.addEventListener('change', (e) => {
      mv.setAttribute('environment-image', e.target.value);
    });

    window.addEventListener('keydown', (ev) => {
      if (ev.key === 'r') resetBtn.click();
      if (ev.key === ' ') toggleBtn.click();
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>